<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <style>
        .ql-editor {
            min-height: 200px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            font-size: 14px;
        }
        .ql-toolbar {
            border-top-left-radius: 0.375rem;
            border-top-right-radius: 0.375rem;
            border-bottom: none;
        }
        .ql-container {
            border-bottom-left-radius: 0.375rem;
            border-bottom-right-radius: 0.375rem;
            border-top: none;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">Portfolio API Admin</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4">API Status</h2>
                <div id="apiStatus" class="text-green-600 font-medium">Checking...</div>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4">Endpoints</h2>
                <ul class="space-y-2 text-sm">
                    <li><code class="bg-gray-100 px-2 py-1 rounded">/api/homepage</code></li>
                    <li><code class="bg-gray-100 px-2 py-1 rounded">/api/about</code></li>
                    <li><code class="bg-gray-100 px-2 py-1 rounded">/api/works</code></li>
                    <li><code class="bg-gray-100 px-2 py-1 rounded">/api/contact</code></li>
                </ul>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4">Quick Test</h2>
                <button onclick="testAPI()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Test API
                </button>
                <div id="testResult" class="mt-4 text-sm"></div>
            </div>
        </div>

        <!-- Add/Edit Work Form -->
        <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold" id="formTitle">Add New Work</h2>
                <button id="toggleFormBtn" onclick="toggleForm()" class="text-blue-600 hover:text-blue-800 text-sm">
                    Switch to Edit Mode
                </button>
            </div>
            
            <form id="workForm" class="space-y-4">
                <input type="hidden" id="editId" value="">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Title *</label>
                        <input type="text" id="title" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Slug *</label>
                        <input type="text" id="slug" required placeholder="my-project-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="text-xs text-gray-500 mt-1">This will be used for the URL: /api/work/[slug]</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                        <select id="category" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Select Category</option>
                            <option value="Web Application">Web Application</option>
                            <option value="E-commerce">E-commerce</option>
                            <option value="Management System">Management System</option>
                            <option value="Education">Education</option>
                            <option value="Content Management">Content Management</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Date *</label>
                        <input type="text" id="date" placeholder="2024" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Image URL or Path *</label>
                    <input type="text" id="image" required placeholder="https://example.com/image.png or /images/works/project.png" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description *</label>
                    <textarea id="description" rows="3" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Long Description</label>
                    
                    <!-- Toggle Buttons -->
                    <div class="flex gap-2 mb-2">
                        <button type="button" id="normalViewBtn" onclick="switchToNormalView()" class="px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600">
                            üìù Normal View
                        </button>
                        <button type="button" id="richViewBtn" onclick="switchToRichView()" class="px-3 py-1 bg-gray-300 text-gray-700 text-sm rounded hover:bg-gray-400">
                            ‚ú® Rich Text Editor
                        </button>
                        <button type="button" id="htmlViewBtn" onclick="switchToHtmlView()" class="px-3 py-1 bg-gray-300 text-gray-700 text-sm rounded hover:bg-gray-400">
                            üîß HTML View
                        </button>
                    </div>
                    
                    <!-- Normal Text Editor -->
                    <div id="normalEditor" style="display: block;">
                        <textarea id="normalTextArea" rows="12" placeholder="Write your content here in normal text format..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    
                    <!-- Rich Text Editor -->
                    <div id="richEditor" style="display: none;">
                        <div id="editor" style="height: 300px;"></div>
                    </div>
                    
                    <!-- HTML Editor -->
                    <div id="htmlEditor" style="display: none;">
                        <textarea id="htmlTextArea" rows="12" placeholder="Write your HTML content here..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm"></textarea>
                    </div>
                    
                    <div class="flex gap-2 mt-2">
                        <button type="button" onclick="clearLongDescription()" class="px-3 py-1 bg-gray-500 text-white text-sm rounded hover:bg-gray-600">
                            üóëÔ∏è Clear
                        </button>
                        <button type="button" onclick="getEditorContent()" class="px-3 py-1 bg-green-500 text-white text-sm rounded hover:bg-green-600">
                            üìã Get Content
                        </button>
                        <button type="button" onclick="previewContent()" class="px-3 py-1 bg-purple-500 text-white text-sm rounded hover:bg-purple-600">
                            üëÅÔ∏è Preview
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">üí° Switch between Normal View (plain text), Rich Text Editor (WYSIWYG), and HTML View (direct HTML editing).</p>
                </div>



                <!-- Tech Stack Section -->
                <div class="border-t pt-4">
                    <h3 class="text-lg font-medium text-gray-800 mb-3">Tech Stack</h3>
                    <div id="techStackContainer" class="space-y-2">
                        <div class="flex gap-2">
                            <input type="text" placeholder="Technology name (e.g., React)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 tech-name">
                            <input type="text" placeholder="Icon URL or path (e.g., /images/skills/React_logo.svg)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 tech-icon">
                            <button type="button" onclick="removeTechStack(this)" class="px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600">Remove</button>
                        </div>
                    </div>
                    <button type="button" onclick="addTechStack()" class="mt-2 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                        + Add Tech Stack Item
                    </button>
                </div>

                <!-- Project Details Section -->
                <div class="border-t pt-4">
                    <h3 class="text-lg font-medium text-gray-800 mb-3">Project Details</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Challenges</label>
                            <textarea id="challenges" rows="3" placeholder="Describe the technical challenges faced during development..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Solutions</label>
                            <textarea id="solutions" rows="3" placeholder="Describe how you solved the challenges..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Results</label>
                            <textarea id="results" rows="3" placeholder="Describe the outcomes and results achieved..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Gallery Images Section -->
                <div class="border-t pt-4">
                    <h3 class="text-lg font-medium text-gray-800 mb-3">Project Gallery</h3>
                    <div id="galleryContainer" class="space-y-2">
                        <div class="flex gap-2">
                            <input type="text" placeholder="Image URL or path (e.g., /images/works/project1.png)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 gallery-image">
                            <button type="button" onclick="removeGalleryImage(this)" class="px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600">Remove</button>
                        </div>
                    </div>
                    <button type="button" onclick="addGalleryImage()" class="mt-2 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                        + Add Gallery Image
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Live URL</label>
                        <input type="url" id="liveUrl" placeholder="https://project.vercel.app" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">GitHub URL</label>
                        <input type="url" id="githubUrl" placeholder="https://github.com/username/project" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>

                <div class="flex items-center">
                    <input type="checkbox" id="featured" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                    <label for="featured" class="ml-2 block text-sm text-gray-900">Featured on Homepage</label>
                </div>

                <div class="flex gap-4">
                    <button type="submit" id="submitBtn" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">
                        Add Work
                    </button>
                    <button type="button" id="cancelBtn" onclick="cancelEdit()" class="bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600" style="display: none;">
                        Cancel Edit
                    </button>
                </div>
            </form>
        </div>

        <!-- Works List -->
        <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">Current Works</h2>
            <div id="worksList" class="space-y-4">
                <!-- Works will be loaded here -->
            </div>
        </div>
        
        <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">API Response Preview</h2>
            <div class="bg-gray-100 p-4 rounded">
                <pre id="apiResponse" class="text-sm overflow-auto">Click "Test API" to see response</pre>
            </div>
        </div>
    </div>

    <script>
        let isEditMode = false;
        let currentEditId = null;
        let quill = null;
        let currentView = 'normal'; // 'normal', 'rich', 'html'

        // Initialize Quill editor
        document.addEventListener('DOMContentLoaded', function() {
            try {
                quill = new Quill('#editor', {
                    theme: 'snow',
                    placeholder: 'Write your content here using the rich text editor above. You can format text, add headings, lists, and more!',
                    modules: {
                        toolbar: [
                            [{ 'header': [1, 2, 3, false] }],
                            ['bold', 'italic', 'underline', 'strike'],
                            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                            [{ 'color': [] }, { 'background': [] }],
                            [{ 'align': [] }],
                            ['link', 'image'],
                            ['clean']
                        ]
                    }
                });

                // Add event listener for content changes
                quill.on('text-change', function() {
                    console.log('Content changed:', quill.root.innerHTML);
                });

                console.log('‚úÖ Quill editor initialized successfully');
            } catch (error) {
                console.error('‚ùå Error initializing Quill editor:', error);
            }
        });

        // Enhanced HTML parsing function for preview
        function parseLongDescriptionEnhanced(longDescription) {
            if (!longDescription) return "";
            
            // Split by double newlines to separate paragraphs
            const paragraphs = longDescription.split('\n\n');
            
            let htmlContent = '';
            
            paragraphs.forEach(paragraph => {
                const trimmedParagraph = paragraph.trim();
                if (!trimmedParagraph) return;
                
                // Check for markdown-style headings
                if (trimmedParagraph.startsWith('# ')) {
                    htmlContent += `<h1>${trimmedParagraph.substring(2)}</h1>`;
                } else if (trimmedParagraph.startsWith('## ')) {
                    htmlContent += `<h2>${trimmedParagraph.substring(3)}</h2>`;
                } else if (trimmedParagraph.startsWith('### ')) {
                    htmlContent += `<h3>${trimmedParagraph.substring(4)}</h3>`;
                } else if (trimmedParagraph.match(/^[üéØüë•üíºüé®üîßüåç]/)) {
                    // This is a section header with emoji
                    htmlContent += `<h3>${trimmedParagraph}</h3>`;
                } else if (trimmedParagraph.match(/^[A-Z][A-Z\s]+:$/)) {
                    // This is a section header in ALL CAPS with colon
                    htmlContent += `<h3>${trimmedParagraph}</h3>`;
                } else if (trimmedParagraph.includes('\n') && trimmedParagraph.includes(':')) {
                    // This might be a list section with header
                    const lines = trimmedParagraph.split('\n');
                    const header = lines[0];
                    const listItems = lines.slice(1).filter(line => line.trim());
                    
                    htmlContent += `<h4>${header}</h4>`;
                    if (listItems.length > 0) {
                        htmlContent += '<ul>';
                        listItems.forEach(item => {
                            const cleanItem = item.replace(/^[-‚Ä¢*]\s*/, '').trim();
                            if (cleanItem) {
                                htmlContent += `<li>${cleanItem}</li>`;
                            }
                        });
                        htmlContent += '</ul>';
                    }
                } else if (trimmedParagraph.includes('\n')) {
                    // This is a list section without a header
                    const lines = trimmedParagraph.split('\n').filter(line => line.trim());
                    if (lines.length > 0) {
                        // Check if it's a list (starts with bullet points or has multiple lines)
                        const isList = lines.some(line => line.match(/^[-‚Ä¢*]/)) || lines.length > 2;
                        
                        if (isList) {
                            htmlContent += '<ul>';
                            lines.forEach(line => {
                                const cleanLine = line.replace(/^[-‚Ä¢*]\s*/, '').trim();
                                if (cleanLine) {
                                    htmlContent += `<li>${cleanLine}</li>`;
                                }
                            });
                            htmlContent += '</ul>';
                        } else {
                            // Multiple lines but not a list - treat as paragraphs
                            lines.forEach(line => {
                                if (line.trim()) {
                                    htmlContent += `<p>${line.trim()}</p>`;
                                }
                            });
                        }
                    }
                } else {
                    // This is a regular paragraph - process markdown-style formatting
                    let processedParagraph = trimmedParagraph;
                    
                    // Convert **bold** to <strong>
                    processedParagraph = processedParagraph.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    
                    // Convert *italic* to <em>
                    processedParagraph = processedParagraph.replace(/\*(.*?)\*/g, '<em>$1</em>');
                    
                    // Convert `code` to <code>
                    processedParagraph = processedParagraph.replace(/`(.*?)`/g, '<code>$1</code>');
                    
                    htmlContent += `<p>${processedParagraph}</p>`;
                }
            });
            
            return htmlContent;
        }



        function clearLongDescription() {
            if (confirm('Are you sure you want to clear the long description?')) {
                if (currentView === 'normal') {
                    document.getElementById('normalTextArea').value = '';
                } else if (currentView === 'html') {
                    document.getElementById('htmlTextArea').value = '';
                } else if (currentView === 'rich' && quill) {
                    quill.setText('');
                }
            }
        }

        function getEditorContent() {
            let content = '';
            let contentType = '';
            
            if (currentView === 'normal') {
                content = document.getElementById('normalTextArea').value;
                contentType = 'Normal Text';
            } else if (currentView === 'html') {
                content = document.getElementById('htmlTextArea').value;
                contentType = 'HTML Content';
            } else if (currentView === 'rich' && quill) {
                content = quill.root.innerHTML;
                contentType = 'Rich Text HTML';
            }
            
            alert(`${contentType}:\n\n${content}`);
            console.log('Editor Content:', content);
        }

        function switchToNormalView() {
            // Store current content before switching
            const previousView = currentView;
            
            currentView = 'normal';
            document.getElementById('normalEditor').style.display = 'block';
            document.getElementById('richEditor').style.display = 'none';
            document.getElementById('htmlEditor').style.display = 'none';
            
            document.getElementById('normalViewBtn').className = 'px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600';
            document.getElementById('richViewBtn').className = 'px-3 py-1 bg-gray-300 text-gray-700 text-sm rounded hover:bg-gray-400';
            document.getElementById('htmlViewBtn').className = 'px-3 py-1 bg-gray-300 text-gray-700 text-sm rounded hover:bg-gray-400';
            
            // Sync content from the previous view
            if (previousView === 'html') {
                const htmlTextArea = document.getElementById('htmlTextArea');
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = htmlTextArea.value;
                document.getElementById('normalTextArea').value = tempDiv.textContent || tempDiv.innerText || '';
            } else if (previousView === 'rich' && quill) {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = quill.root.innerHTML;
                document.getElementById('normalTextArea').value = tempDiv.textContent || tempDiv.innerText || '';
            }
        }

        function switchToHtmlView() {
            // Store current content before switching
            const previousView = currentView;
            
            currentView = 'html';
            document.getElementById('normalEditor').style.display = 'none';
            document.getElementById('richEditor').style.display = 'none';
            document.getElementById('htmlEditor').style.display = 'block';
            
            document.getElementById('normalViewBtn').className = 'px-3 py-1 bg-gray-300 text-gray-700 text-sm rounded hover:bg-gray-400';
            document.getElementById('richViewBtn').className = 'px-3 py-1 bg-gray-300 text-gray-700 text-sm rounded hover:bg-gray-400';
            document.getElementById('htmlViewBtn').className = 'px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600';
            
            // Sync content from the previous view
            if (previousView === 'normal') {
                const normalTextArea = document.getElementById('normalTextArea');
                const text = normalTextArea.value;
                const html = text.split('\n\n').map(paragraph => 
                    paragraph.trim() ? `<p>${paragraph.trim()}</p>` : ''
                ).join('');
                document.getElementById('htmlTextArea').value = html;
            } else if (previousView === 'rich' && quill) {
                document.getElementById('htmlTextArea').value = quill.root.innerHTML;
            }
        }

        function switchToRichView() {
            // Store current content before switching
            const previousView = currentView;
            
            currentView = 'rich';
            document.getElementById('normalEditor').style.display = 'none';
            document.getElementById('richEditor').style.display = 'block';
            document.getElementById('htmlEditor').style.display = 'none';
            
            document.getElementById('normalViewBtn').className = 'px-3 py-1 bg-gray-300 text-gray-700 text-sm rounded hover:bg-gray-400';
            document.getElementById('richViewBtn').className = 'px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600';
            document.getElementById('htmlViewBtn').className = 'px-3 py-1 bg-gray-300 text-gray-700 text-sm rounded hover:bg-gray-400';
            
            // Sync content from the previous view
            if (previousView === 'normal' && quill) {
                const normalTextArea = document.getElementById('normalTextArea');
                const text = normalTextArea.value;
                const html = text.split('\n\n').map(paragraph => 
                    paragraph.trim() ? `<p>${paragraph.trim()}</p>` : ''
                ).join('');
                quill.root.innerHTML = html;
            } else if (previousView === 'html' && quill) {
                const htmlTextArea = document.getElementById('htmlTextArea');
                quill.root.innerHTML = htmlTextArea.value;
            }
        }

        function syncContentToNormal() {
            const normalTextArea = document.getElementById('normalTextArea');
            const htmlTextArea = document.getElementById('htmlTextArea');
            
            // Get content from the view we're switching FROM
            let sourceContent = '';
            
            if (currentView === 'html') {
                // We're switching FROM html view TO normal view
                sourceContent = htmlTextArea.value;
            } else if (quill) {
                // We're switching FROM rich view TO normal view
                sourceContent = quill.root.innerHTML;
            }
            
            if (sourceContent) {
                // Convert HTML to plain text
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = sourceContent;
                normalTextArea.value = tempDiv.textContent || tempDiv.innerText || '';
            }
        }

        function syncContentToHtml() {
            const normalTextArea = document.getElementById('normalTextArea');
            const htmlTextArea = document.getElementById('htmlTextArea');
            
            // Get content from the view we're switching FROM
            let sourceContent = '';
            
            if (currentView === 'normal') {
                // We're switching FROM normal view TO html view
                sourceContent = normalTextArea.value;
            } else if (quill) {
                // We're switching FROM rich view TO html view
                sourceContent = quill.root.innerHTML;
            }
            
            if (sourceContent) {
                if (currentView === 'normal') {
                    // Convert plain text to HTML
                    const text = sourceContent;
                    const html = text.split('\n\n').map(paragraph => 
                        paragraph.trim() ? `<p>${paragraph.trim()}</p>` : ''
                    ).join('');
                    htmlTextArea.value = html;
                } else {
                    // Already HTML content
                    htmlTextArea.value = sourceContent;
                }
            }
        }

        function previewContent() {
            let content = '';
            
            if (currentView === 'normal') {
                const text = document.getElementById('normalTextArea').value;
                content = text.split('\n\n').map(paragraph => 
                    paragraph.trim() ? `<p>${paragraph.trim()}</p>` : ''
                ).join('');
            } else if (currentView === 'html') {
                content = document.getElementById('htmlTextArea').value;
            } else if (currentView === 'rich' && quill) {
                content = quill.root.innerHTML;
            }
            
            // Show preview in a modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-4xl w-full max-h-[80vh] overflow-hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Content Preview</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                    </div>
                    <div class="overflow-auto max-h-[60vh] border border-gray-300 p-4 rounded">
                        ${content}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function getCurrentContent() {
            if (currentView === 'normal') {
                const text = document.getElementById('normalTextArea').value;
                // Convert plain text to HTML
                return text.split('\n\n').map(paragraph => 
                    paragraph.trim() ? `<p>${paragraph.trim()}</p>` : ''
                ).join('');
            } else if (currentView === 'html') {
                return document.getElementById('htmlTextArea').value;
            } else if (currentView === 'rich' && quill) {
                return quill.root.innerHTML;
            }
            return '';
        }

        function debugEditor() {
            console.log('Quill instance:', quill);
            console.log('Editor element:', document.getElementById('editor'));
            if (quill) {
                console.log('Current content:', quill.root.innerHTML);
                console.log('Current text:', quill.getText());
            }
        }



        // Check API status on load
        window.onload = function() {
            checkAPIStatus();
            loadWorks();
        };

        async function checkAPIStatus() {
            try {
                const response = await fetch('/');
                if (response.ok) {
                    document.getElementById('apiStatus').textContent = '‚úÖ API is running';
                    document.getElementById('apiStatus').className = 'text-green-600 font-medium';
                } else {
                    document.getElementById('apiStatus').textContent = '‚ùå API error';
                    document.getElementById('apiStatus').className = 'text-red-600 font-medium';
                }
            } catch (error) {
                document.getElementById('apiStatus').textContent = '‚ùå Connection failed';
                document.getElementById('apiStatus').className = 'text-red-600 font-medium';
            }
        }

        async function testAPI() {
            const resultDiv = document.getElementById('testResult');
            const responseDiv = document.getElementById('apiResponse');
            
            resultDiv.textContent = 'Testing...';
            
            try {
                const response = await fetch('/api/homepage');
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.textContent = '‚úÖ API working correctly';
                    resultDiv.className = 'mt-4 text-sm text-green-600';
                    responseDiv.textContent = JSON.stringify(data, null, 2);
                } else {
                    resultDiv.textContent = '‚ùå API returned error';
                    resultDiv.className = 'mt-4 text-sm text-red-600';
                    responseDiv.textContent = JSON.stringify(data, null, 2);
                }
            } catch (error) {
                resultDiv.textContent = '‚ùå Connection failed: ' + error.message;
                resultDiv.className = 'mt-4 text-sm text-red-600';
                responseDiv.textContent = 'Error: ' + error.message;
            }
        }

        async function loadWorks() {
            try {
                const response = await fetch('/api/admin/works');
                const works = await response.json();
                displayWorks(works);
            } catch (error) {
                console.error('Error loading works:', error);
            }
        }

        function displayWorks(works) {
            const worksList = document.getElementById('worksList');
            worksList.innerHTML = '';

            works.forEach(work => {
                const workDiv = document.createElement('div');
                workDiv.className = 'border border-gray-200 rounded-lg p-4';
                workDiv.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <h3 class="font-semibold text-lg">${work.title}</h3>
                            <p class="text-gray-600">${work.category} ‚Ä¢ ${work.date}</p>
                            <p class="text-sm text-gray-500 mt-1">${work.description}</p>
                            ${work.longDescription ? `<p class="text-xs text-green-600 mt-1">üìù Has long description (${work.longDescription.length} chars)</p>` : '<p class="text-xs text-gray-400 mt-1">No long description</p>'}
                            <p class="text-xs text-blue-600 mt-1">Slug: ${work.slug || 'auto-generated'}</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="px-2 py-1 text-xs rounded ${work.featured ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                ${work.featured ? 'Featured' : 'Regular'}
                            </span>
                            <button onclick="editWork(${work.id})" class="px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600">
                                Edit
                            </button>
                            <button onclick="deleteWork(${work.id})" class="px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600">
                                Delete
                            </button>
                        </div>
                    </div>
                `;
                worksList.appendChild(workDiv);
            });
        }

        function toggleForm() {
            isEditMode = !isEditMode;
            const formTitle = document.getElementById('formTitle');
            const submitBtn = document.getElementById('submitBtn');
            const toggleBtn = document.getElementById('toggleFormBtn');
            const cancelBtn = document.getElementById('cancelBtn');

            if (isEditMode) {
                formTitle.textContent = 'Edit Work';
                submitBtn.textContent = 'Update Work';
                toggleBtn.textContent = 'Switch to Add Mode';
                cancelBtn.style.display = 'inline-block';
            } else {
                formTitle.textContent = 'Add New Work';
                submitBtn.textContent = 'Add Work';
                toggleBtn.textContent = 'Switch to Edit Mode';
                cancelBtn.style.display = 'none';
                clearForm();
            }
        }

        function clearForm() {
            document.getElementById('workForm').reset();
            document.getElementById('editId').value = '';
            currentEditId = null;
            
            // Clear all editors
            document.getElementById('normalTextArea').value = '';
            document.getElementById('htmlTextArea').value = '';
            if (quill) {
                quill.setText('');
            }
            
            // Reset to normal view
            currentView = 'normal';
            document.getElementById('normalEditor').style.display = 'block';
            document.getElementById('richEditor').style.display = 'none';
            document.getElementById('htmlEditor').style.display = 'none';
            
            document.getElementById('normalViewBtn').className = 'px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600';
            document.getElementById('richViewBtn').className = 'px-3 py-1 bg-gray-300 text-gray-700 text-sm rounded hover:bg-gray-400';
            document.getElementById('htmlViewBtn').className = 'px-3 py-1 bg-gray-300 text-gray-700 text-sm rounded hover:bg-gray-400';
            
            // Clear dynamic sections
            document.getElementById('techStackContainer').innerHTML = `
                <div class="flex gap-2">
                    <input type="text" placeholder="Technology name (e.g., React)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 tech-name">
                    <input type="text" placeholder="Icon URL or path (e.g., /images/skills/React_logo.svg)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 tech-icon">
                    <button type="button" onclick="removeTechStack(this)" class="px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600">Remove</button>
                </div>
            `;
            document.getElementById('galleryContainer').innerHTML = `
                <div class="flex gap-2">
                    <input type="text" placeholder="Image URL or path (e.g., /images/works/project1.png)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 gallery-image">
                    <button type="button" onclick="removeGalleryImage(this)" class="px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600">Remove</button>
                </div>
            `;
        }

        function cancelEdit() {
            isEditMode = false;
            toggleForm();
        }

        async function editWork(id) {
            try {
                const response = await fetch(`/api/admin/works/${id}`);
                if (response.ok) {
                    const work = await response.json();
                    populateForm(work);
                    
                    if (!isEditMode) {
                        toggleForm();
                    }
                } else {
                    alert('Error loading work data');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error loading work data');
            }
        }

        function populateForm(work) {
            currentEditId = work.id;
            document.getElementById('editId').value = work.id;
            document.getElementById('title').value = work.title || '';
            document.getElementById('slug').value = work.slug || '';
            document.getElementById('category').value = work.category || '';
            document.getElementById('date').value = work.date || '';
            document.getElementById('image').value = work.image || '';
            document.getElementById('description').value = work.description || '';
            // Handle long description for all views
            const longDescription = work.longDescription || '';
            
            // Set content in normal text area (convert HTML to plain text)
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = longDescription;
            document.getElementById('normalTextArea').value = tempDiv.textContent || tempDiv.innerText || '';
            
            // Set content in HTML text area
            document.getElementById('htmlTextArea').value = longDescription;
            
            // Set content in Quill editor
            if (quill) {
                quill.root.innerHTML = longDescription;
            }
            document.getElementById('challenges').value = work.challenges || '';
            document.getElementById('solutions').value = work.solutions || '';
            document.getElementById('results').value = work.results || '';
            document.getElementById('liveUrl').value = work.links?.live || '';
            document.getElementById('githubUrl').value = work.links?.github || '';
            document.getElementById('featured').checked = work.featured || false;

            // Populate tech stack
            const techStackContainer = document.getElementById('techStackContainer');
            techStackContainer.innerHTML = '';
            if (work.techStack && work.techStack.length > 0) {
                work.techStack.forEach(tech => {
                    addTechStackItem(tech.name, tech.icon);
                });
            } else {
                addTechStackItem('', '');
            }

            // Populate gallery
            const galleryContainer = document.getElementById('galleryContainer');
            galleryContainer.innerHTML = '';
            if (work.gallery && work.gallery.length > 0) {
                work.gallery.forEach(image => {
                    addGalleryImageItem(image);
                });
            } else {
                addGalleryImageItem('');
            }
        }

        function addTechStackItem(name = '', icon = '') {
            const container = document.getElementById('techStackContainer');
            const newItem = document.createElement('div');
            newItem.className = 'flex gap-2';
            newItem.innerHTML = `
                <input type="text" placeholder="Technology name (e.g., React)" value="${name}" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 tech-name">
                <input type="text" placeholder="Icon URL or path (e.g., /images/skills/React_logo.svg)" value="${icon}" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 tech-icon">
                <button type="button" onclick="removeTechStack(this)" class="px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600">Remove</button>
            `;
            container.appendChild(newItem);
        }

        function addGalleryImageItem(image = '') {
            const container = document.getElementById('galleryContainer');
            const newItem = document.createElement('div');
            newItem.className = 'flex gap-2';
            newItem.innerHTML = `
                <input type="text" placeholder="Image URL or path (e.g., /images/works/project1.png)" value="${image}" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 gallery-image">
                <button type="button" onclick="removeGalleryImage(this)" class="px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600">Remove</button>
            `;
            container.appendChild(newItem);
        }

        async function deleteWork(id) {
            if (confirm('Are you sure you want to delete this work?')) {
                try {
                    const response = await fetch(`/api/admin/works/${id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        alert('Work deleted successfully!');
                        loadWorks();
                    } else {
                        alert('Error deleting work');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error deleting work');
                }
            }
        }

        // Tech Stack Functions
        function addTechStack() {
            addTechStackItem();
        }

        function removeTechStack(button) {
            button.parentElement.remove();
        }

        // Gallery Functions
        function addGalleryImage() {
            addGalleryImageItem();
        }

        function removeGalleryImage(button) {
            button.parentElement.remove();
        }

        // Handle form submission
        document.getElementById('workForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Collect tech stack data
            const techStack = [];
            const techNames = document.querySelectorAll('.tech-name');
            const techIcons = document.querySelectorAll('.tech-icon');
            
            for (let i = 0; i < techNames.length; i++) {
                if (techNames[i].value.trim() && techIcons[i].value.trim()) {
                    techStack.push({
                        name: techNames[i].value.trim(),
                        icon: techIcons[i].value.trim()
                    });
                }
            }

            // Collect gallery images
            const gallery = [];
            const galleryInputs = document.querySelectorAll('.gallery-image');
            galleryInputs.forEach(input => {
                if (input.value.trim()) {
                    gallery.push(input.value.trim());
                }
            });

            const formData = {
                title: document.getElementById('title').value,
                slug: document.getElementById('slug').value,
                category: document.getElementById('category').value,
                date: document.getElementById('date').value,
                image: document.getElementById('image').value,
                description: document.getElementById('description').value,
                longDescription: getCurrentContent(),
                techStack: techStack,
                challenges: document.getElementById('challenges').value,
                solutions: document.getElementById('solutions').value,
                results: document.getElementById('results').value,
                gallery: gallery,
                links: {
                    live: document.getElementById('liveUrl').value,
                    github: document.getElementById('githubUrl').value
                },
                featured: document.getElementById('featured').checked
            };

            try {
                const url = isEditMode ? `/api/admin/works/${currentEditId}` : '/api/admin/works';
                const method = isEditMode ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    const result = await response.json();
                    alert(isEditMode ? `Work "${result.title}" updated successfully!` : `Work "${result.title}" added successfully!`);
                    
                    if (!isEditMode) {
                        clearForm();
                    }
                    
                    loadWorks();
                } else {
                    alert(isEditMode ? 'Error updating work' : 'Error adding work');
                }
            } catch (error) {
                console.error('Error:', error);
                alert(isEditMode ? 'Error updating work' : 'Error adding work');
            }
        });
    </script>
</body>
</html>
