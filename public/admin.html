<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">Portfolio API Admin</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4">API Status</h2>
                <div id="apiStatus" class="text-green-600 font-medium">Checking...</div>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4">Endpoints</h2>
                <ul class="space-y-2 text-sm">
                    <li><code class="bg-gray-100 px-2 py-1 rounded">/api/homepage</code></li>
                    <li><code class="bg-gray-100 px-2 py-1 rounded">/api/about</code></li>
                    <li><code class="bg-gray-100 px-2 py-1 rounded">/api/works</code></li>
                    <li><code class="bg-gray-100 px-2 py-1 rounded">/api/contact</code></li>
                </ul>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4">Quick Test</h2>
                <button onclick="testAPI()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Test API
                </button>
                <div id="testResult" class="mt-4 text-sm"></div>
            </div>
        </div>

        <!-- Add Work Form -->
        <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">Add New Work</h2>
            <form id="addWorkForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Title *</label>
                        <input type="text" id="title" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Slug *</label>
                        <input type="text" id="slug" required placeholder="my-project-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="text-xs text-gray-500 mt-1">This will be used for the URL: /api/work/[slug]</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                        <select id="category" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Select Category</option>
                            <option value="Web Application">Web Application</option>
                            <option value="E-commerce">E-commerce</option>
                            <option value="Management System">Management System</option>
                            <option value="Education">Education</option>
                            <option value="Content Management">Content Management</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Date *</label>
                        <input type="text" id="date" placeholder="2024" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Image URL *</label>
                    <input type="url" id="image" required placeholder="https://example.com/image.png" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description *</label>
                    <textarea id="description" rows="3" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Long Description</label>
                    <textarea id="longDescription" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>

                <!-- Tech Stack Section -->
                <div class="border-t pt-4">
                    <h3 class="text-lg font-medium text-gray-800 mb-3">Tech Stack</h3>
                    <div id="techStackContainer" class="space-y-2">
                        <div class="flex gap-2">
                            <input type="text" placeholder="Technology name (e.g., React)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 tech-name">
                            <input type="text" placeholder="Icon URL or path (e.g., /images/skills/React_logo.svg)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 tech-icon">
                            <button type="button" onclick="removeTechStack(this)" class="px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600">Remove</button>
                        </div>
                    </div>
                    <button type="button" onclick="addTechStack()" class="mt-2 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                        + Add Tech Stack Item
                    </button>
                </div>

                <!-- Project Details Section -->
                <div class="border-t pt-4">
                    <h3 class="text-lg font-medium text-gray-800 mb-3">Project Details</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Challenges</label>
                            <textarea id="challenges" rows="3" placeholder="Describe the technical challenges faced during development..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Solutions</label>
                            <textarea id="solutions" rows="3" placeholder="Describe how you solved the challenges..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Results</label>
                            <textarea id="results" rows="3" placeholder="Describe the outcomes and results achieved..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Gallery Images Section -->
                <div class="border-t pt-4">
                    <h3 class="text-lg font-medium text-gray-800 mb-3">Project Gallery</h3>
                    <div id="galleryContainer" class="space-y-2">
                        <div class="flex gap-2">
                            <input type="text" placeholder="Image URL or path (e.g., /images/works/project1.png)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 gallery-image">
                            <button type="button" onclick="removeGalleryImage(this)" class="px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600">Remove</button>
                        </div>
                    </div>
                    <button type="button" onclick="addGalleryImage()" class="mt-2 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                        + Add Gallery Image
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Live URL</label>
                        <input type="url" id="liveUrl" placeholder="https://project.vercel.app" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">GitHub URL</label>
                        <input type="url" id="githubUrl" placeholder="https://github.com/username/project" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>

                <div class="flex items-center">
                    <input type="checkbox" id="featured" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                    <label for="featured" class="ml-2 block text-sm text-gray-900">Featured on Homepage</label>
                </div>

                <button type="submit" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">
                    Add Work
                </button>
            </form>
        </div>

        <!-- Works List -->
        <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">Current Works</h2>
            <div id="worksList" class="space-y-4">
                <!-- Works will be loaded here -->
            </div>
        </div>
        
        <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">API Response Preview</h2>
            <div class="bg-gray-100 p-4 rounded">
                <pre id="apiResponse" class="text-sm overflow-auto">Click "Test API" to see response</pre>
            </div>
        </div>
    </div>

    <script>
        // Check API status on load
        window.onload = function() {
            checkAPIStatus();
            loadWorks();
        };

        async function checkAPIStatus() {
            try {
                const response = await fetch('/');
                if (response.ok) {
                    document.getElementById('apiStatus').textContent = '✅ API is running';
                    document.getElementById('apiStatus').className = 'text-green-600 font-medium';
                } else {
                    document.getElementById('apiStatus').textContent = '❌ API error';
                    document.getElementById('apiStatus').className = 'text-red-600 font-medium';
                }
            } catch (error) {
                document.getElementById('apiStatus').textContent = '❌ Connection failed';
                document.getElementById('apiStatus').className = 'text-red-600 font-medium';
            }
        }

        async function testAPI() {
            const resultDiv = document.getElementById('testResult');
            const responseDiv = document.getElementById('apiResponse');
            
            resultDiv.textContent = 'Testing...';
            
            try {
                const response = await fetch('/api/homepage');
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.textContent = '✅ API working correctly';
                    resultDiv.className = 'mt-4 text-sm text-green-600';
                    responseDiv.textContent = JSON.stringify(data, null, 2);
                } else {
                    resultDiv.textContent = '❌ API returned error';
                    resultDiv.className = 'mt-4 text-sm text-red-600';
                    responseDiv.textContent = JSON.stringify(data, null, 2);
                }
            } catch (error) {
                resultDiv.textContent = '❌ Connection failed: ' + error.message;
                resultDiv.className = 'mt-4 text-sm text-red-600';
                responseDiv.textContent = 'Error: ' + error.message;
            }
        }

        async function loadWorks() {
            try {
                const response = await fetch('/api/admin/works');
                const works = await response.json();
                displayWorks(works);
            } catch (error) {
                console.error('Error loading works:', error);
            }
        }

        function displayWorks(works) {
            const worksList = document.getElementById('worksList');
            worksList.innerHTML = '';

            works.forEach(work => {
                const workDiv = document.createElement('div');
                workDiv.className = 'border border-gray-200 rounded-lg p-4';
                workDiv.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">${work.title}</h3>
                            <p class="text-gray-600">${work.category} • ${work.date}</p>
                            <p class="text-sm text-gray-500 mt-1">${work.description}</p>
                            <p class="text-xs text-blue-600 mt-1">Slug: ${work.slug || 'auto-generated'}</p>
                        </div>
                        <div class="text-right">
                            <span class="px-2 py-1 text-xs rounded ${work.featured ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                ${work.featured ? 'Featured' : 'Regular'}
                            </span>
                        </div>
                    </div>
                `;
                worksList.appendChild(workDiv);
            });
        }

        // Tech Stack Functions
        function addTechStack() {
            const container = document.getElementById('techStackContainer');
            const newItem = document.createElement('div');
            newItem.className = 'flex gap-2';
            newItem.innerHTML = `
                <input type="text" placeholder="Technology name (e.g., React)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 tech-name">
                <input type="text" placeholder="Icon URL or path (e.g., /images/skills/React_logo.svg)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 tech-icon">
                <button type="button" onclick="removeTechStack(this)" class="px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600">Remove</button>
            `;
            container.appendChild(newItem);
        }

        function removeTechStack(button) {
            button.parentElement.remove();
        }

        // Gallery Functions
        function addGalleryImage() {
            const container = document.getElementById('galleryContainer');
            const newItem = document.createElement('div');
            newItem.className = 'flex gap-2';
            newItem.innerHTML = `
                <input type="text" placeholder="Image URL or path (e.g., /images/works/project1.png)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 gallery-image">
                <button type="button" onclick="removeGalleryImage(this)" class="px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600">Remove</button>
            `;
            container.appendChild(newItem);
        }

        function removeGalleryImage(button) {
            button.parentElement.remove();
        }

        // Handle form submission
        document.getElementById('addWorkForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Collect tech stack data
            const techStack = [];
            const techNames = document.querySelectorAll('.tech-name');
            const techIcons = document.querySelectorAll('.tech-icon');
            
            for (let i = 0; i < techNames.length; i++) {
                if (techNames[i].value.trim() && techIcons[i].value.trim()) {
                    techStack.push({
                        name: techNames[i].value.trim(),
                        icon: techIcons[i].value.trim()
                    });
                }
            }

            // Collect gallery images
            const gallery = [];
            const galleryInputs = document.querySelectorAll('.gallery-image');
            galleryInputs.forEach(input => {
                if (input.value.trim()) {
                    gallery.push(input.value.trim());
                }
            });

            const formData = {
                title: document.getElementById('title').value,
                slug: document.getElementById('slug').value,
                category: document.getElementById('category').value,
                date: document.getElementById('date').value,
                image: document.getElementById('image').value,
                description: document.getElementById('description').value,
                longDescription: document.getElementById('longDescription').value,
                techStack: techStack,
                challenges: document.getElementById('challenges').value,
                solutions: document.getElementById('solutions').value,
                results: document.getElementById('results').value,
                gallery: gallery,
                links: {
                    live: document.getElementById('liveUrl').value,
                    github: document.getElementById('githubUrl').value
                },
                featured: document.getElementById('featured').checked
            };

            try {
                const response = await fetch('/api/admin/works', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    const newWork = await response.json();
                    alert(`Work "${newWork.title}" added successfully!`);
                    document.getElementById('addWorkForm').reset();
                    
                    // Clear dynamic sections
                    document.getElementById('techStackContainer').innerHTML = `
                        <div class="flex gap-2">
                            <input type="text" placeholder="Technology name (e.g., React)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 tech-name">
                            <input type="text" placeholder="Icon URL or path (e.g., /images/skills/React_logo.svg)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 tech-icon">
                            <button type="button" onclick="removeTechStack(this)" class="px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600">Remove</button>
                        </div>
                    `;
                    document.getElementById('galleryContainer').innerHTML = `
                        <div class="flex gap-2">
                            <input type="text" placeholder="Image URL or path (e.g., /images/works/project1.png)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 gallery-image">
                            <button type="button" onclick="removeGalleryImage(this)" class="px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600">Remove</button>
                        </div>
                    `;
                    
                    loadWorks();
                } else {
                    alert('Error adding work');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error adding work');
            }
        });
    </script>
</body>
</html>
